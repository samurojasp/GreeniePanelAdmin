<c-row>
  <c-col xs>
    <c-card class="mb-4">
      <c-card-body>
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="card-title text-center" id="users">
            Aportes de Información
          </h4>
          <c-dropdown *ngIf="role === 'admin'">
            <button
              cButton
              cDropdownToggle
              class="form-control ms-md-2 mb-3 text-center"
              color="auto"
              size="sm"
            >
              {{ getDepartmentFilterTitle(departmentFilter) }}
            </button>
            <ul cDropdownMenu auto>
              <li>
                <button (click)="setDepartmentFilter(0)" cDropdownItem>
                  Todos los departamentos
                </button>
              </li>
              @for (department of departments; track department.id){
              <li>
                <button
                  (click)="setDepartmentFilter(department.id)"
                  cDropdownItem
                >
                  {{ department.id }} - {{ department.name }}
                </button>
              </li>
              }
            </ul>
          </c-dropdown>
          <c-dropdown>
            <button
              cButton
              cDropdownToggle
              class="form-control ms-md-2 mb-3 text-center"
              color="auto"
              size="sm"
            >
              {{ getCategoryFilterTitle(categoryFilter) }}
            </button>
            <ul cDropdownMenu auto>
              <li>
                <button (click)="setCategoryFilter(0)" cDropdownItem>
                  Todas las categorías
                </button>
              </li>
              @for (ctg of categories; track ctg.id){
              <li>
                <button (click)="setCategoryFilter(ctg.id)" cDropdownItem>
                  {{ ctg.id }} - {{ ctg.name }}
                </button>
              </li>
              }
            </ul>
          </c-dropdown>
          <c-dropdown>
            <button
              cButton
              cDropdownToggle
              class="form-control ms-md-2 mb-3 text-center"
              color="auto"
              size="sm"
            >
              {{ getIndicatorFilterTitle(indicatorFilter) }}
            </button>
            <ul cDropdownMenu auto>
              <li>
                <button (click)="setIndicatorFilter(0)" cDropdownItem>
                  Todos los indicadores
                </button>
              </li>
              @for (ind of indicators; track ind.id){
              <li>
                <button (click)="setIndicatorFilter(ind.id)" cDropdownItem>
                  {{ ind.id }} - {{ ind.name }}
                </button>
              </li>
              }
            </ul>
          </c-dropdown>
          <a
            cButton
            routerLinkActive="active"
            [ngStyle]="{
              'background-color': '#5A835A',
              border: '1px solid #5A835A'
            }"
            class="text-white ms-md-2 mb-3"
            (click)="goToCreate()"
          >
            Agregar aporte
          </a>
        </div>
        <table
          [hover]="true"
          [responsive]="true"
          [striped]="true"
          align="middle"
          cTable
          class="mb-0 border"
        >
          <thead class="text-nowrap text-truncate">
            <tr>
              <th *ngIf="role === 'admin'" class="bg-body-tertiary text-center">
                Departamento
              </th>
              <th class="bg-body-tertiary text-center">Indicador</th>
              <th class="bg-body-tertiary text-center">Categoría</th>
              <th class="bg-body-tertiary text-center">Fecha</th>
              <th class="bg-body-tertiary text-center">Acción</th>
            </tr>
          </thead>
          <tbody>
            @for (contribution of contributions | paginate: { itemsPerPage:
            pagination.take, currentPage: pagination.page, totalItems:
            pagination.itemCount}; track contribution.id; let i = $index) {
            <tr>
              <td *ngIf="role === 'admin'" class="text-center">
                {{ contribution.user.department.name }}
              </td>
              <td class="text-center">
                {{ contribution.category.indicator.name }}
              </td>
              <td class="text-center">
                {{ contribution.category.name }}
              </td>
              <td class="text-center">
                {{ transformDate(contribution.createAt) }}
              </td>
              <td class="text-center">
                <div class="fw-semibold text-nowrap">
                  <button
                    cButton
                    color="warning"
                    variant="outline"
                    class="mx-1"
                    (click)="goToEdit(contribution.id)"
                  >
                    <svg cIcon class="icon icon-lg" name="cilPencil"></svg>
                  </button>
                  <button
                    cButton
                    [cModalToggle]="staticBackdropModal.id"
                    (click)="toggleLiveDemo(contribution.id)"
                    color="danger"
                    variant="outline"
                    class="mx-1"
                  >
                    <svg cIcon class="icon icon-lg" name="cilTrash"></svg>
                  </button>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>

        <div class="pagination-container">
          <pagination-controls
            (pageChange)="setPage($event)"
            (pageBoundsCorrection)="setPage($event)"
            previousLabel=""
            nextLabel=""
          >
          </pagination-controls>
        </div>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

<c-modal
  #staticBackdropModal
  backdrop="static"
  id="staticBackdropModal"
  alignment="center"
>
  <c-modal-header>
    <h5 cModalTitle class="float-center">
      ¿Estás seguro de eliminar este usuario?
    </h5>
    <button [cModalToggle]="staticBackdropModal.id" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>Una vez eliminado no podra ser recuperado</c-modal-body>
  <c-modal-footer>
    <button [cModalToggle]="staticBackdropModal.id" cButton color="white">
      Cerrar
    </button>
    <button
      cButton
      (click)="deleteContribution()"
      [cModalToggle]="staticBackdropModal.id"
      class="accept-button"
    >
      Aceptar
    </button>
  </c-modal-footer>
</c-modal>

<c-toaster [placement]="position" class="p-3" position="fixed">
  <c-toast
    (timer)="onTimerChange($event)"
    (visibleChange)="onVisibleChange($event)"
    [visible]="visible"
    [class]="toastClass"
  >
    <c-toast-body>
      <p>{{ toastMessage }}</p>
      <c-progress thin>
        <c-progress-bar [value]="percentage"></c-progress-bar>
      </c-progress>
    </c-toast-body>
  </c-toast>
</c-toaster>

<ngx-spinner
  bdColor="rgba(0,0,0,0.65)"
  size="large"
  color="rgb(60, 179, 113)"
  type="ball-scale-multiple"
>
  <p style="color: white">Cargando...</p>
</ngx-spinner>
